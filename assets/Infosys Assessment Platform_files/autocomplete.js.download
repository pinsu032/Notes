var classesTrie,keywordsTrie,shortcutsTrie,KEYWORDS=["abstract","assert","break","case","catch","class","const","continue","default","do","else","enum","extends","final","finally","float","for","if","implements","import","instanceof","interface","native","new","package","private","protected","public","return","static","strictfp","super","switch","synchronized","this","throw","throws","transient","try","volatile","while","byte","short","int","long","float","double","boolean","char","void","true","false","null"],SHORTCUTS={sysout:"System.out.println()",syserr:"System.err.println()"},classFullNameMap={},allClasses=[],classDetails={};function updateClassDetails(obj){classDetails=obj}function updateClassNames(obj){for(var property in classFullNameMap=obj,classesTrie=new Triejs,obj)obj.hasOwnProperty(property)&&classesTrie.add(obj[property].name,obj[property]);createKeywordsTrie(),createShortcutsTrie()}function createKeywordsTrie(){for(var property in keywordsTrie=new Triejs,KEYWORDS)KEYWORDS.hasOwnProperty(property)&&keywordsTrie.add(KEYWORDS[property],{text:KEYWORDS[property]});}function createShortcutsTrie(){for(var property in shortcutsTrie=new Triejs,SHORTCUTS)SHORTCUTS.hasOwnProperty(property)&&shortcutsTrie.add(property,{text:property,displayText:SHORTCUTS[property],hint:completeShortcut,expandedText:SHORTCUTS[property]});}var JAVA_MODIFIERS=["public","protected","private","static","abstract","final","native","synchronized","transient","volatile","strictfp"];function isModifier(word){return 0<=JAVA_MODIFIERS.indexOf(word)}var JAVA_BASIC_TYPES=["byte","Short","char","int","long","float","double","boolean"];function isBasicType(word){return 0<=JAVA_BASIC_TYPES.indexOf(word)}function parseJavaContents(editor,cursor){var tokens=[],pos={line:0,ch:0,n:0,i:0},currentTokenIndex=-1,variables={},startDeclaration=!1,continueDeclaration=!1,declarationTokens=[];tokens=[];CodeMirror.runMode(editor.getValue(),"text/x-java",function(token,styleClass){(""!==token.trim()&&(tokens.push({token:token,type:styleClass,index:pos.i,pos:{line:pos.line,ch:pos.ch}}),pos.i++,pos.line<cursor.line?currentTokenIndex++:pos.line==cursor.line&&pos.ch<cursor.ch&&currentTokenIndex++),"\n"===token?(pos.ch=0,pos.line++):(pos.n+=token.length,pos.ch+=token.length),continueDeclaration&&""!==token.trim())&&(0<declarationTokens.length&&("class"===declarationTokens[0].token||"interface"===declarationTokens[0].token||"enum"===declarationTokens[0].token)&&("{"===token?((newVal=variables[declarationTokens[1].token]||[]).push(declarationTokens),variables[declarationTokens[1].token]=newVal,continueDeclaration=!1,declarationTokens=[]):declarationTokens.push(tokens[pos.i-1])));if(startDeclaration&&""!==token.trim())if("class"===tokens[pos.i-2].token||"enum"===tokens[pos.i-2].token)declarationTokens.push(tokens[pos.i-2]),declarationTokens.push(tokens[pos.i-1]),continueDeclaration=!0;else if(3<=pos.i&&"@"===tokens[pos.i-3].token&&"interface"===tokens[pos.i-2].token){var newVal;declarationTokens.push(tokens[pos.i-3]),declarationTokens.push(tokens[pos.i-2]),declarationTokens.push(tokens[pos.i-1]),(newVal=variables[token]||[]).push(declarationTokens),variables[token]=newVal,continueDeclaration=!1,declarationTokens=[]}else"interface"===tokens[pos.i-2].token?(declarationTokens.push(tokens[pos.i-2]),declarationTokens.push(tokens[pos.i-1]),continueDeclaration=!0):isModifier(tokens[pos.i-2].token)&&(isModifier(tokens[pos.i-1].token)||(continueDeclaration=!0));"{"===token||"}"===token||"("===token||")"===token||","===token||";"===token||"class"===token||"interface"===token||"enum"===token?startDeclaration=!0:-1<JAVA_MODIFIERS.indexOf(token)?startDeclaration=!0:""!==token.trim()&&(startDeclaration=!1)});for(var tokensCount=tokens.length,packageProcessed=!1,result={imports:[],additionalWords:[]},i=0;i<tokensCount;i++){var pair=tokens[i];if(""!==pair.token.trim())if(packageProcessed||"package"!==pair.token){if("import"===pair.token){(packageResult=processImportLine(tokens,i)).importStmt.pos=pair.pos,result.imports.push(packageResult.importStmt),packageResult.importStmt.line.endsWith("*")||result.additionalWords.push(packageResult.importStmt.line.split(/[.]/).pop()),i=packageResult.finalI}else if("variable"===pair.type||"variable-3"===pair.type){if("variable"===tokens[i+1].type||"variable-3"===tokens[i+1].type)if("("===tokens[i+2].token){"function"==typeof(newVal=variables[tokens[i+1].token]||[])&&(newVal=[]);for(var declarationTokens1=[],j=i;j<tokens.length&&(declarationTokens1.push(tokens[j]),")"!==tokens[j].token);j++);newVal.push(declarationTokens1),variables[tokens[i+1].token]=newVal}else{var newVal;(newVal=variables[tokens[i+1].token]||[]).push([tokens[i],tokens[i+1]]),variables[tokens[i+1].token]=newVal}result.additionalWords.push(pair.token)}}else{packageProcessed=!0;var packageResult=processPackage(tokens,i);result.package=packageResult.packageName,i=packageResult.finalI,result.packageEndPos=tokens[i+1].pos}}return result.currentExpression=findCurrentExpression(tokens,currentTokenIndex),result.variables=variables,result}function processPackage(tokens,i){for(var package="";++i<tokens.length;){var pair=tokens[i];if(""!==pair.token.trim()){if("variable"!==pair.type&&"variable-3"!==pair.type&&"def"!==pair.type&&"."!==pair.token)break;package+=pair.token}}return{packageName:package,finalI:i}}function processImportLine(tokens,i){for(var importStmt={},importedClass="";++i<tokens.length;){var pair=tokens[i];if(""!==pair.token.trim())if("variable"!==pair.type&&"variable-3"!==pair.type&&"def"!==pair.type&&"."!==pair.token&&"*"!==pair.token){if("static"!==pair.token)break;importStmt.isStatic=!0}else importedClass+=pair.token}return importStmt.line=importedClass,{importStmt:importStmt,finalI:i}}function findCurrentExpression(tokens,currentTokenIndex){tokens[currentTokenIndex];for(var expressionTokens=[],whitespace=!1,j=currentTokenIndex;0<=j;j--){var pair=tokens[j];if(""!==pair.token.trim()){if("."===pair.token||"class"===pair.token||"string"===pair.type)expressionTokens.unshift(pair);else{if("variable"!==pair.type&&"variable-3"!==pair.type){break}if(whitespace)break;expressionTokens.unshift(pair)}whitespace=!1}else whitespace=!0}return expressionTokens}function completeShortcut(editor,self,data){editor.replaceRange(data.expandedText,self.from,self.to)}function insertImport(editor,self,data){editor.replaceRange(data.text,self.from,self.to),editor.replaceRange("import "+data.displayText.replace(/\$/g,".")+";\n",data.importPos||{line:0,ch:0})}function hintFn(editor,options){var cursor=editor.getCursor();var token=editor.getTokenAt(cursor);var result=parseJavaContents(editor,cursor);if(!result.currentExpression)return createCompletionsList([],cursor,token);if(1===result.currentExpression.length)return createCompletionsList(handleBeginingExpression(token,result),cursor,token);if(2<=result.currentExpression.length)return createCompletionsList(handleLongerExpression(token,result),cursor,token);return createCompletionsList([].concat([]),cursor,token)}function createCompletionsList(list,cursor,token){return "."==token.string?{list:list,from:{line:cursor.line,ch:token.end}}:{list:list,from:{line:cursor.line,ch:token.start},to:{line:cursor.line,ch:token.end}}}function handleBeginingExpression(token,result){var keywordSuggestions=keywordsTrie.find(token.string)||[],additionalWordsCompletions=getAdditionalWordsCompletions(token,result),importPos=result.packageEndPos||{ch:0,line:0};result.imports&&0<result.imports.length&&(importPos=result.imports[0].pos);var classesCompletions=getClassesCompletions(token,result.imports,importPos),shortcutCompletions=shortcutsTrie.find(token.string)||[];return dedupeArray(keywordSuggestions.concat(additionalWordsCompletions,classesCompletions,shortcutCompletions))}function handleLongerExpression(token,result){var expr=getCurrentExprWithoutPartialToken(result);var possibleDeclarations=result.variables[expr[0].token];var currentTokenIndex=expr[0].index,isStatic=!1,classFullName="";if("string"===expr[0].type)isStatic=!1,classFullName="java.lang.String";else if(possibleDeclarations&&0<possibleDeclarations.length){for(var type=possibleDeclarations[0][0].token,i=1;i<possibleDeclarations.length&&possibleDeclarations[i][0].index<currentTokenIndex;i++)type=possibleDeclarations[i][0].token;classFullNameMap[type]?(isStatic=!1,classFullName=classFullNameMap[type].fullName):classFullNameMap[expr[0].token]&&classFullNameMap[expr[0].token].fullName&&(classFullName=classFullNameMap[expr[0].token].fullName,isStatic=!0)}else classFullNameMap[expr[0].token]&&classFullNameMap[expr[0].token].fullName&&(classFullName=classFullNameMap[expr[0].token].fullName,isStatic=!0);for(i=2;"."===expr[1].token&&i<expr.length;i++){var exprElement=expr[i];if("."!==exprElement.token){var classDetail=classDetails[classFullName];if("."===expr[i+1].token){var elements=isStatic?classDetail.staticFields:classDetail.nonStaticFields;if(isStatic&&"class"===exprElement.token&&(isStatic=!1,classFullName="java.lang.Class"),elements)for(var property in elements)if(elements.hasOwnProperty(property)&&property===exprElement.token){isStatic=!1,classFullName=elements[property].fieldType;break}}}};var fields,methods;classDetail=classDetails[classFullName];if(!classDetail)return[];isStatic?(fields=classDetail.staticFields||[],methods=classDetail.staticMethods||[]):(fields=classDetail.nonStaticFields||[],methods=classDetail.nonStaticMethods||[]);var list=[];for(var property in fields)fields.hasOwnProperty(property)&&("."===token.string||property.startsWith(token.string))&&list.push({text:property});for(var property in methods)if(methods.hasOwnProperty(property)&&("."===token.string||property.startsWith(token.string))){methods[property].argc;var name=property+"(";for(i=0;i<methods[property].argc;i++)name+=(1<=i?", ":"")+"arg"+(i+1);name+=")",list.push({text:name})}return isStatic&&list.push({text:"class"}),list}function getCurrentExprWithoutPartialToken(result){var expr=result.currentExpression;return"."!==expr[expr.length-1].token&&"."===expr[expr.length-2].token&&expr.pop(),expr}function getAdditionalWordsCompletions(token,result){0<=result.additionalWords.indexOf(token.string)&&result.additionalWords.splice(result.additionalWords.indexOf(token.string),1);for(var completions=[],i=result.additionalWords.length-1;0<=i;i--){var word=result.additionalWords[i];word.startsWith(token.string)&&completions.push({text:word})}return completions}function getClassesCompletions(token,imports,importPos){for(var classesFromTrie=classesTrie.find(token.string)||[],list=[],i=classesFromTrie.length-1;0<=i;i--){for(var classFromTrie=classesFromTrie[i],imported=!1,isJavaLang=/^java\.lang\.([^.])+$/.test(classFromTrie.fullName),j=imports.length-1;!isJavaLang&&0<=j;j--){var importStmt=imports[j];if(importStmt.line===classFromTrie.fullName||isWildCardMatch(importStmt.line,classFromTrie.fullName)){imported=!0;break}}imported||isJavaLang?list.push({text:classFromTrie.name,displayText:classFromTrie.fullName,importPos:importPos}):list.push({text:classFromTrie.name,displayText:classFromTrie.fullName,hint:insertImport,importPos:importPos})}return list}function isWildCardMatch(importLine,fullClassName){if(!importLine.endsWith("*"))return!1;var packagePrefix=importLine.substring(0,importLine.length-1);if(!fullClassName.startsWith(packagePrefix))return!1;var className=fullClassName.substring(importLine.length-1);return -1===className.indexOf(".")}function loadJavaScript(url){var elm=document.createElement("script");elm.setAttribute("type","text/javascript"),elm.src=url,elm.async = false;document.head.appendChild(elm)}function dedupeArray(array){for(var a=array.concat(),i=0;i<a.length;++i)for(var j=i+1;j<a.length;++j)_.isEqual(a[i],a[j])&&a.splice(j--,1);return a}loadJavaScript("assets/js/trie.js"),loadJavaScript("assets/js/classNames.js"),loadJavaScript("assets/js/classDetails.js"),CodeMirror.registerHelper("hint","text/x-java",hintFn);