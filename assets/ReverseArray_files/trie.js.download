/**
 * Copyright (C) 2012 Paul Thurlow
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy 
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 * v0.1.5
 */
!function(){var a=function(c){for(var b in this.options={maxCache:10,enableCache:!0,insertOrder:!1,returnRoot:!1,insert:null,sort:null,clip:null,copy:null,merge:null},this.root={},this.index=0,c)c.hasOwnProperty(b)&&(this.options[b]=c[b]);"function"!=typeof this.options.insert&&(this.options.insert=function(e,d){return this.options.insertOrder&&void 0===d.d&&void 0===d.o&&(d={d:d,o:this.index++}),e&&e.length?e.push(d):e=[d],e}),"function"!=typeof this.options.sort&&(this.options.insertOrder?this.options.insertOrder&&(this.options.sort=function(){this.sort(function(e,d){return e.o-d.o})}):this.options.sort=function(){this.sort()}),"function"!=typeof this.options.clip&&(this.options.clip=function(d){this.length>d&&this.splice(d,this.length-d)}),"function"!=typeof this.options.copy&&(this.options.copy=function(d){return d.slice(0)}),"function"!=typeof this.options.merge&&(this.options.merge=function(h,f,g){for(var d=0,e=f.length;d<e;d++)h=this.options.insert.call(this,h,f[d]),this.options.sort.call(h,g),this.options.clip.call(h,this.options.maxCache);return h})};a.prototype={_addCacheData:function(c,b){return!(this.root===c&&!this.options.returnRoot||!1===this.options.enableCache)&&(c.$d||(c.$d={}),c.$d=this.options.insert.call(this,c.$d,b),this.options.sort.call(c.$d),this.options.clip.call(c.$d,this.options.maxCache),!0)},_addSuffix:function(g,e,f){var d=g.charAt(0),b=g.substring(1)||null,c={$d:{}};b&&(c.$s=b),void 0===f[d]?f[d]=c:void 0===f[d].$d&&(f[d].$d={},b&&void 0===f[d].$s&&(f[d].$s=b)),f[d].$d=this.options.insert.call(this,f[d].$d,e),this.options.sort.call(f[d].$d)},_moveSuffix:function(g,e,f){var d=g.charAt(0),b=g.substring(1)||null,c={$d:{}};b&&(c.$s=b),void 0===f[d]&&(f[d]=c),f[d].$d=this.options.copy(e)},_getDataAtNode:function(b,d){var c;return this.options.enableCache?(this.options.sort.call(b.$d,d),c=b.$d):c=this._getSubtree(b,d),this.options.insertOrder&&(c=this._stripInsertOrder(c)),c?this.options.copy(c):void 0},_stripInsertOrder:function(e){if(void 0!==e){for(var b=[],c=0,d=e.length;c<d;c++)b.push(e[c].d);return b}},_getSubtree:function(g,f){for(var c,d,e=[g];d=e.pop();)for(var b in d)d.hasOwnProperty(b)&&("$d"==b?(void 0===c&&(c=[]),c=this.options.merge.call(this,c,d.$d,f)):"$s"!=b&&e.push(d[b]));return c},add:function(g,e){if("string"!=typeof g)return!1;1==arguments.length&&(e=g),g=g.toLowerCase();for(var f=this.root,b=0,c=g.length;b<c;b++){var d=g.charAt(b);if(f[d])b==c-1?(this._addCacheData(f,e),this._addCacheData(f[d],e)||this._addSuffix(d,e,f)):(this._addCacheData(f,e),f=f[d]);else{if(f.$s){if(f.$s==g.substring(b)){this._addCacheData(f,e)||(f.$d=this.options.insert.call(this,f.$d,e),this.options.sort.call(f.$d));break}this._moveSuffix(f.$s,f.$d,f),delete f.$s,!1===this.options.enableCache&&delete f.$d}if(!f[d]){this._addSuffix(g.substring(b),e,f),this._addCacheData(f,e);break}this._addCacheData(f,e),b==c-1&&(f[d].$s?(this._moveSuffix(f[d].$s,f[d].$d,f[d]),delete f[d].$s,!1===this.options.enableCache&&delete f[d].$d,this._addSuffix(d,e,f)):this._addCacheData(f[d],e)||this._addSuffix(d,e,f)),f=f[d]}}},remove:function(b){if("string"==typeof b&&""!==b&&!this.options.enableCache){b=b.toLowerCase();var c,g,k,e,j,f,l=this.root,h=0;for(g=0,k=b.length;g<k;g++){if(!l[c=b.charAt(g)]){if(l.$s&&l.$s===b.substring(g))break;return}l=(e=l)[j=c]}for(var d in f=this.options.copy(l.$d),this.options.insertOrder&&(f=this._stripInsertOrder(f)),delete l.$d,delete l.$s,l)l.hasOwnProperty(d)&&h++;return h||delete e[j],f}},contains:function(f){if("string"!=typeof f||""==f)return!1;f=f.toLowerCase();for(var e=this.root,b=0,c=f.length;b<c;b++){var d=f.charAt(b);if(!e[d])return!(!e.$s||e.$s!==f.substring(b));e=e[d]}return!(!e.$d||void 0!==e.$s)},find:function(e){if("string"==typeof e&&(""!=e||this.options.returnRoot)){e=e.toLowerCase();for(var f=this.root,b=0,c=e.length;b<c;b++){var d=e.charAt(b);if(!f[d])return f.$s&&0==f.$s.indexOf(e.substring(b))?this._getDataAtNode(f,e):void 0;f=f[d]}return this._getDataAtNode(f,e)}}},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=a),exports.Triejs=a):"function"==typeof define&&define.amd?define("triejs",function(){return a}):this.Triejs=a}();